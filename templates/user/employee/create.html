{% extends 'base.html' %}
{% load crispy_forms_tags %}
{% load static %}

{% block title %}
    Create Employee
{% endblock title %}

{% block styles %}
    <style>
        /* Highlight the active tab button with primary background and white text */
        .nav-tabs .nav-link.active {
            background-color: #696cff;  /* Bootstrap primary */
            color: white !important;
            border-color: #696cff #696cff #fff;
        }

        .nav-tabs .nav-link {
            color: #696cff; /* Make inactive tabs primary-colored text */
        }

        .profile-picture-container {
            position: relative;
            width: 150px;
            height: 150px;
            margin: 0 auto;
            border-radius: 50%;
            overflow: hidden;
            background-color: #f8f9fa;
            border: 3px solid #696cff;
        }

        .profile-picture-container img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .profile-picture-container .upload-overlay {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            background: rgba(0, 0, 0, 0.5);
            padding: 5px;
            text-align: center;
            color: white;
            cursor: pointer;
            opacity: 0;
            transition: opacity 0.3s;
        }

        .profile-picture-container:hover .upload-overlay {
            opacity: 1;
        }

        .profile-picture-container input[type="file"] {
            position: absolute;
            width: 100%;
            height: 100%;
            top: 0;
            left: 0;
            opacity: 0;
            cursor: pointer;
        }
    </style>
{% endblock styles %}

{% block content %}
<div class="container-fluid">
    <div class="row">
        <!-- Left Sidebar -->
        <div class="col-md-3 mb-4">
            <div class="card text-center">
                <div class="card-body">
                    <div class="profile-picture-container mb-3">
                        <img src="{% static 'assets/img/avatars/default-avatar.png' %}" alt="Profile Picture" id="profile-preview">
                        <div class="upload-overlay">
                            <i class="fas fa-camera"></i> Change Photo
                        </div>
                        <input type="file" name="profile-profile_picture" id="id_profile_profile_picture" accept="image/*">
                    </div>
                    <h5 class="mb-2">{{ user_form.first_name.value }} {{ user_form.last_name.value }}</h5>
                    <p class="text-muted mb-1">{{ user_form.email.value }}</p>
                    <p class="text-muted">{{ profile_form.mobile_number.value }}</p>
                </div>
            </div>
        </div>

        <!-- Right Side Form Tabs -->
        <div class="col-md-9">
            <div class="mb-3">
                <a class="btn btn-outline-info btn-sm" href="{% url 'user:employee_list' %}">Employee List</a>
            </div>

            <!-- Tabs -->
            <ul class="nav nav-tabs mb-3" id="employeeTabs" role="tablist">
                <li class="nav-item" role="presentation">
                    <button class="nav-link active" id="profile-tab" data-bs-toggle="tab" data-bs-target="#profile" type="button">Profile</button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link" id="work-tab" data-bs-toggle="tab" data-bs-target="#work" type="button">Work</button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link" id="payroll-tab" data-bs-toggle="tab" data-bs-target="#payroll" type="button">Payroll</button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link" id="document-tab" data-bs-toggle="tab" data-bs-target="#document" type="button">Document</button>
                </li>
            </ul>

            <div class="tab-content" id="employeeTabsContent">
                <!-- Profile Tab -->
                <div class="tab-pane fade show active" id="profile" role="tabpanel">
                    <form method="POST" enctype="multipart/form-data">
                        {% csrf_token %}
                        <input type="hidden" name="form_section" value="profile">
                        <div class="row">
                            <div class="col-md-6">
                                {{ user_form|crispy }}
                            </div>
                            <div class="col-md-6">
                                {{ profile_form|crispy }}
                            </div>
                        </div>
                        <div class="text-center mt-3">
                            <button type="submit" class="btn btn-success">Save</button>
                            <a href="{% url 'user:employee_list' %}" class="btn btn-warning">Cancel</a>
                        </div>
                    </form>
                </div>

                <!-- Work Tab -->
                <div class="tab-pane fade" id="work" role="tabpanel">
                    <form method="POST">
                        {% csrf_token %}
                        <input type="hidden" name="form_section" value="work">
                        <div class="row">
                            <div class="col-md-12">
                                {{ working_form|crispy }}
                            </div>
                        </div>
                        <div class="text-center mt-3">
                            <button type="submit" class="btn btn-success">Save</button>
                            <a href="{% url 'user:employee_list' %}" class="btn btn-warning">Cancel</a>
                        </div>
                    </form>
                </div>

                <!-- Payroll Tab -->
                <div class="tab-pane fade" id="payroll" role="tabpanel">
                    <form method="POST">
                        {% csrf_token %}
                        <input type="hidden" name="form_section" value="payroll">
                        <p>Add payroll details here.</p>
                        <div class="text-center mt-3">
                            <button type="submit" class="btn btn-success">Save</button>
                            <a href="{% url 'user:employee_list' %}" class="btn btn-warning">Cancel</a>
                        </div>
                    </form>
                </div>

                <!-- Document Tab -->
                <div class="tab-pane fade" id="document" role="tabpanel">
                    <form method="POST">
                        {% csrf_token %}
                        <input type="hidden" name="form_section" value="document">
                        <p>Add document details here.</p>
                        <div class="text-center mt-3">
                            <button type="submit" class="btn btn-success">Save</button>
                            <a href="{% url 'user:employee_list' %}" class="btn btn-warning">Cancel</a>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock content %}

{% block scripts %}
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script>
    window.onload = function () {
        var joining_date = document.getElementById("joining_date");
        if (joining_date) {
            joining_date.nepaliDatePicker();
        }
    };

    // Preview profile picture before upload
    document.getElementById('id_profile_profile_picture').addEventListener('change', function(e) {
        const file = e.target.files[0];
        if (file) {
            const reader = new FileReader();
            reader.onload = function(e) {
                document.getElementById('profile-preview').src = e.target.result;
            }
            reader.readAsDataURL(file);
        }
    });
</script>
{% endblock %}
